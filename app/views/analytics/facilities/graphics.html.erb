<div class="snapshot snapshot-simple">
  <div class="dashboard">

    <div class="snapshot-header">
      <span><%= t('analytics.graphics.facility.report_title', organization_name: @organization.name) %></span>
      <%= @current_month.strftime('%B %Y') %>
    </div>
    <h1><%= @facility.name %></h1>
    <p style="line-height: 1.3; margin: 0.5em 0 0.5em 0;">
      <%= t('analytics.graphics.facility.report_message') %>
    </p>

    <div class="featured">
      <table class="featured-table">
        <tr>
          <td class="featured-td">
            <div class="featured-section" style="background-image: url(/assets/icon-bp.png);">
              <strong class="featured-title"><%= t('analytics.graphics.facility.blood_pressures_recorded_in_month') %></strong>
              <span class="featured-number"><%= @facility_analytics.unique_patients_recorded_per_month[@current_month] %></span>

              <%= render "shared/graph",
                         column_class: '',
                         graph_data: @facility_analytics.unique_patients_recorded_per_month
                             .map { |month, no_of_patients| [month.strftime('%b'), no_of_patients] }.to_h,
                         max_value: @facility_analytics.unique_patients_recorded_per_month.values.max %>
            </div>
          </td>
        </tr>

        <tr>
          <td class="featured-td">
            <div class="featured-section">
              <strong class="featured-title"><%= t('analytics.graphics.facility.patients_recorded_this_month') %></strong>
              <span class="featured-number text-green">
                <%= t('analytics.graphics.facility.patients_recorded_this_month_count_message',
                      count: @facility_analytics.newly_enrolled_patients_this_month) %>
              </span>

              <%= render "shared/graph",
                         column_class: 'featured-graph-column-green',
                         graph_data: @facility_analytics.newly_enrolled_patients_per_month
                             .map { |month, no_of_patients| [month.strftime('%b'), no_of_patients] }.to_h,
                         max_value: @facility_analytics.unique_patients_recorded_per_month.values.max %>
            </div>
          </td>
        </tr>

        <tr>
          <td class="featured-td">
            <div class="featured-section" style="background-image: url(/assets/icon-sad.png);">
              <strong class="featured-title"><%= t('analytics.graphics.facility.overdue_patients_this_month') %></strong>
              <span class="featured-number text-yellow">
                <%= t('analytics.graphics.facility.overdue_patients_this_month_count_message',
                      count: @facility_analytics.overdue_patients_count_this_month) %>
              </span>


              <%= render "shared/graph",
                         column_class: 'featured-graph-column-yellow',
                         graph_data: @facility_analytics.overdue_patients_count_per_month(6)
                             .map { |month, no_of_patients| [month.strftime('%b'), no_of_patients] }.to_h,
                         max_value: @facility_analytics.overdue_patients_count_per_month(6).values.max %>

            </div>
            <p style="margin-bottom: 0; padding: 16px 70px 0 0; text-align: right; background: url(/assets/icon-arrow.png) 90% 30% no-repeat; background-size: 40px; line-height: 1.2;" class="text-yellow">
              Try calling these patients to ask<br>them to return for treatment?
            </p>
          </td>
        </tr>
      </table>

    </div>
  </div>
</div>

<div style="margin: 2em 0;"></div>

<div class="snapshot">
  <div class="dashboard">
    <div class="snapshot-header">
      <span><%= t('analytics.graphics.facility.report_title', organization_name: @organization.name) %></span>
      <%= @current_month.strftime('%B %Y') %>
    </div>

    <h1><%= @facility.name %></h1>
    <p class="dashboard-description"><b>#5 of 22</b> reporting PHCs in Brooklyn District.</p>

    <div class="featured">
      <table class="featured-table">
        <tr>
          <td class="featured-middle featured-td">
            <div class="featured-section">
              <strong class="featured-title" style="color: #007A31;">Newly enrolled</strong>
              <span class="featured-number text-green"><%= @facility_analytics.newly_enrolled_patients_this_month %></span>
              <span class="featured-label">New patients</span>

              <strong class="featured-title" style="color: #007A31; margin-top: 8px;">Return patients</strong>
              <span class="featured-number  text-green"><%= @facility_analytics.returning_patients_count_this_month %></span>
              <!--span class="featured-label">Return patients</span-->
            </div>
            <div class="featured-footer">
              <strong>All time:</strong>
              <span><%= @facility_analytics.all_time_patients_count %> enrolled</span>
            </div>
          </td>
          <td class="featured-td">
            <div class="featured-section">
              <strong class="featured-title" style="color: #E0B000;">Didn't attend</strong>
              <span class="featured-number text-yellow">1,321</span>
              <span class="featured-label">Patients</span>

              <%= render "shared/graph",
                         column_class: 'featured-graph-column-yellow',
                         graph_data: @facility_analytics.overdue_patients_count_per_month(4)
                             .map { |month, no_of_patients| [month.strftime('%b'), no_of_patients] }.to_h,
                         max_value: @facility_analytics.overdue_patients_count_per_month(4).values.max %>
            </div>
            <!--
             <div class="featured-footer">
              <strong>Contact attempts:</strong>
              <span>401 calls</span>
            </div>
            -->
          </td>
          <td class="featured-td">
            <div class="featured-section">
              <strong class="featured-title">BP control</strong>
              <span class="featured-number"><%= "#{@facility_analytics.control_rate_for_this_month}%"  || 'N/A' %></span>
              <span class="featured-label">Goal: 65%</span>

              <%= render "shared/graph",
                         column_class: 'featured-graph-column',
                         graph_data: @facility_analytics.control_rate_per_month(4)
                             .map { |month, percent| [month.strftime('%b'), percent] }.to_h,
                         max_value: @facility_analytics.control_rate_per_month(4).values.max %>

            </div>
            <div class="featured-footer">
              <strong>District average:</strong>
              <span>42% control</span>
            </div>
          </td>
        </tr>
      </table>

    </div>
  </div>

  <!--
  <div class="snapshot-goal">
    <b>Goal: 65% BP control.</b> To achieve the goal, 776 more hypertensive patients need to get their BP &lt; 140/90
  </div>
  -->

  <div style="margin-top: 8px; padding-top: 6px; color: #999; margin-right: 0; border-top: 1px solid #F0F2F5;">
    <p class="footnote"><strong>Didn't attend</strong> patients are enrolled hypertensives that have not had a BP
      recorded in the past 3 months.</p>
    <p class="footnote"><strong>BP control</strong>
      <%= t('analytics.graphics.facility.footnote.control_rate_explanation',
            hypertensive_patients_in_cohort: @facility_analytics.hypertensive_patients_in_cohort_this_month.count,
            patients_under_control: @facility_analytics.controlled_patients_for_facility(@facility_analytics.hypertensive_patients_in_cohort_this_month.pluck(:patient_id)).count,
            control_rate_for_month: @facility_analytics.control_rate_for_this_month) %>
    </p>
    <p class="footnote"><strong>District average</strong> is calculated for all PHCs with > 100 enrolled patients.</p>
  </div>
</div>